(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{7314:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(108)}])},108:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return E}});var n=a(2322),s=a(2784),r=a(7962),l=a(9560),i=a(8932),o=a(4225),d=JSON.parse('{"Lk":"0x67d87837504C5f271ef0561CBC80bE08114E127C","Mt":[{"inputs":[{"internalType":"uint256","name":"_index","type":"uint256"}],"name":"buyProduct","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"getProductsLength","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_index","type":"uint256"}],"name":"readProduct","outputs":[{"internalType":"address payable","name":"","type":"address"},{"internalType":"string","name":"","type":"string"},{"internalType":"string","name":"","type":"string"},{"internalType":"string","name":"","type":"string"},{"internalType":"string","name":"","type":"string"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_name","type":"string"},{"internalType":"string","name":"_image","type":"string"},{"internalType":"string","name":"_description","type":"string"},{"internalType":"string","name":"_location","type":"string"},{"internalType":"uint256","name":"_price","type":"uint256"}],"name":"writeProduct","outputs":[],"stateMutability":"nonpayable","type":"function"}]}'),c=a(528);let u=(e,t)=>{let a=c.O$.from(1e6),{config:n}=(0,l.PJ)({address:d.Lk,abi:d.Mt,functionName:e,args:t,overrides:{gasLimit:a},onError:e=>{console.log({err:e})}}),{data:s,isSuccess:r,write:i,writeAsync:o,error:u,isLoading:p}=(0,l.GG)(n);return{data:s,isSuccess:r,write:i,writeAsync:o,isLoading:p}};var p=JSON.parse('{"L":"0x874069Fa1Eb16D44d622F2e0Ca25eeA172369bC1","M":[{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}]}'),m=()=>{let[e,t]=(0,s.useState)(!1),[a,d]=(0,s.useState)(""),[c,m]=(0,s.useState)(0),[x,g]=(0,s.useState)(""),[h,y]=(0,s.useState)(""),[b,f]=(0,s.useState)(""),[w]=(0,o.Nr)(a,500),[v]=(0,o.Nr)(c,500),[j]=(0,o.Nr)(x,500),[N]=(0,o.Nr)(h,500),[T]=(0,o.Nr)(b,500),[S,k]=(0,s.useState)(""),[P,C]=(0,s.useState)(!1),E=a&&c&&x&&b&&h,L=()=>{d(""),m(0),g(""),y(""),f("")},_=r.parseEther("".concat(v.toString()||0)),{writeAsync:M}=u("writeProduct",[w,j,N,T,_]),A=async()=>{if(!M)throw"Failed to create product";if(k("Creating..."),!E)throw Error("Please fill all fields");let e=await M();k("Waiting for confirmation..."),await e.wait(),t(!1),L()},D=async e=>{e.preventDefault();try{await i.Am.promise(A(),{pending:"Creating product...",success:"Product created successfully",error:"Something went wrong. Try again."})}catch(e){console.log({e}),i.Am.error((null==e?void 0:e.message)||"Something went wrong. Try again.")}finally{k("")}},{address:O,isConnected:B}=(0,l.mA)(),{data:F}=(0,l.KQ)({address:O,token:p.L});return(0,s.useEffect)(()=>{if(B&&F){C(!0);return}C(!1)},[F,B]),(0,n.jsxs)("div",{className:"flex flex-row w-full justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("button",{type:"button",onClick:()=>t(!0),className:"inline-block ml-4 px-6 py-2.5 bg-black text-white font-medium text-md leading-tight rounded-2xl shadow-md hover:bg-blue-700 hover:shadow-lg focus:bg-blue-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-blue-800 active:shadow-lg transition duration-150 ease-in-out","data-bs-toggle":"modal","data-bs-target":"#exampleModalCenter",children:"Add Product"}),e&&(0,n.jsx)("div",{className:"fixed z-40 overflow-y-auto top-0 w-full left-0",id:"modal",children:(0,n.jsx)("form",{onSubmit:D,children:(0,n.jsxs)("div",{className:"flex items-center justify-center min-height-100vh pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,n.jsx)("div",{className:"fixed inset-0 transition-opacity",children:(0,n.jsx)("div",{className:"absolute inset-0 bg-gray-900 opacity-75"})}),(0,n.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen",children:"​"}),(0,n.jsxs)("div",{className:"inline-block align-center bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",role:"dialog","aria-modal":"true","aria-labelledby":"modal-headline",children:[(0,n.jsxs)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[(0,n.jsx)("label",{children:"Product Name"}),(0,n.jsx)("input",{onChange:e=>{d(e.target.value)},required:!0,type:"text",className:"w-full bg-gray-100 p-2 mt-2 mb-3"}),(0,n.jsx)("label",{children:"Product Image (URL)"}),(0,n.jsx)("input",{onChange:e=>{g(e.target.value)},required:!0,type:"text",className:"w-full bg-gray-100 p-2 mt-2 mb-3"}),(0,n.jsx)("label",{children:"Product Description"}),(0,n.jsx)("input",{onChange:e=>{y(e.target.value)},required:!0,type:"text",className:"w-full bg-gray-100 p-2 mt-2 mb-3"}),(0,n.jsx)("label",{children:"Product Location"}),(0,n.jsx)("input",{onChange:e=>{f(e.target.value)},required:!0,type:"text",className:"w-full bg-gray-100 p-2 mt-2 mb-3"}),(0,n.jsx)("label",{children:"Product Price (cUSD)"}),(0,n.jsx)("input",{onChange:e=>{m(e.target.value)},required:!0,type:"number",className:"w-full bg-gray-100 p-2 mt-2 mb-3"})]}),(0,n.jsxs)("div",{className:"bg-gray-200 px-4 py-3 text-right",children:[(0,n.jsxs)("button",{type:"button",className:"py-2 px-4 bg-gray-500 text-white rounded hover:bg-gray-700 mr-2",onClick:()=>t(!1),children:[(0,n.jsx)("i",{className:"fas fa-times"})," Cancel"]}),(0,n.jsx)("button",{type:"submit",disabled:!!S||!E||!M,className:"py-2 px-4 bg-blue-500 text-white rounded hover:bg-blue-700 mr-2",children:S||"Create"})]})]})]})})})]}),P&&(0,n.jsxs)("span",{className:"inline-block text-dark ml-4 px-6 py-2.5 font-medium text-md leading-tight rounded-2xl shadow-none ","data-bs-toggle":"modal","data-bs-target":"#exampleModalCenter",children:["Balance: ",Number((null==F?void 0:F.formatted)||0).toFixed(2)," cUSD"]})]})};let x=(e,t,a,n)=>{let s=(0,l.do)({address:d.Lk,abi:d.Mt,functionName:e,args:t,watch:a,overrides:n?{from:n}:void 0,onError:e=>{console.log({err:e})}});return s};var g=a(9097),h=a.n(g),y=a(6625),b=a(5415);let f=e=>(0,n.jsx)(b.Z,{size:14,scale:4,className:"identicon border-2 border-white rounded-full",seed:e}),w=e=>{let t=c.O$.from(1e6),{config:a}=(0,l.PJ)({address:p.L,abi:p.M,functionName:"approve",args:[d.Lk,e],overrides:{gasLimit:t},onError:e=>{console.log({err:e})}}),{data:n,isSuccess:s,write:r,writeAsync:i,error:o,isLoading:u}=(0,l.GG)(a);return{data:n,isSuccess:s,write:r,writeAsync:i,isLoading:u}};var v=e=>{let{productName:t,productPrice:a,ProductSeller:s,transactionHash:r}=e;return(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{children:["Product Name: ",t]}),(0,n.jsxs)("p",{children:["Product Price: ",a," cUSD"]}),(0,n.jsxs)("p",{children:["product seller: ",s," "]}),(0,n.jsxs)("p",{children:["Transaction Hash: ",r]})]})},j=e=>{let{product:t,onClose:a,handlePurchase:s}=e,l=r.formatEther(t.price.toString());return(0,n.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,n.jsxs)("div",{className:"flex items-end justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[(0,n.jsx)("div",{className:"fixed inset-0 transition-opacity",children:(0,n.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-75",onClick:a})}),(0,n.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen",children:"​"}),(0,n.jsx)("div",{className:"inline-block w-full max-w-5xl px-8 pt-5 pb-6 overflow-hidden text-left align-middle transition-all transform bg-white rounded-lg shadow-xl sm:my-8 sm:align-middle sm:w-full sm:p-6",children:(0,n.jsxs)("div",{className:"flex h-96",children:[(0,n.jsx)("img",{src:t.image,alt:t.name,className:"w-1/2 h-full object-cover rounded-lg shadow-md"}),(0,n.jsxs)("div",{className:"ml-6 w-1/2",children:[(0,n.jsx)("h3",{className:"text-2xl font-semibold text-gray-900",children:t.name}),(0,n.jsx)("p",{className:"mt-4 text-sm text-gray-600",children:t.description}),(0,n.jsx)("p",{className:"mt-3 font-semibold text-lg",children:"".concat(l," cUSD")}),(0,n.jsx)("p",{className:"mt-1 text-gray-700",children:"Location: ".concat(t.location)}),(0,n.jsxs)("button",{onClick:s,className:"mt-4 h-14 w-full border-[1px] border-gray-500 text-black p-2 rounded-lg hover:bg-black hover:text-white",children:["Buy for ",r.formatEther(t.price.toString())," cUSD"]}),(0,n.jsx)("div",{className:"mt-6",children:(0,n.jsx)("button",{type:"button",className:" h-14 w-full border-[1px] border-gray-500 text-black p-2 rounded-lg hover:bg-gray-300 hover:text-white",onClick:a,children:"Close"})})]})]})})]})})},N=e=>{var t;let{id:a,setError:o,setLoading:d,clear:c}=e,[p,m]=(0,s.useState)(!1),[g,b]=(0,s.useState)(""),[N,T]=(0,s.useState)(!1),{address:S}=(0,l.mA)(),{data:k}=x("readProduct",[a],!0),{writeAsync:P}=u("buyProduct",[Number(a)]),[C,E]=(0,s.useState)(null),{writeAsync:L}=w((null==C?void 0:null===(t=C.price)||void 0===t?void 0:t.toString())||"0"),{openConnectModal:_}=(0,y.We)(),M=(0,s.useCallback)(()=>{if(!k)return null;E({owner:k[0],name:k[1],image:k[2],description:k[3],location:k[4],price:Number(k[5]),sold:k[6].toString()})},[k]);(0,s.useEffect)(()=>{M()},[M]);let A=async()=>{if(!L||!P)throw"Failed to purchase this product";let e=await L();await e.wait(1),d("Purchasing...");let t=await P();await t.wait(),m(!0),b(t.hash),i.Am.success((0,n.jsx)(v,{productName:null==C?void 0:C.name,productPrice:null==C?void 0:C.price,ProductSeller:null==C?void 0:C.owner,transactionHash:t.hash}),{position:i.Am.POSITION.TOP_CENTER,autoClose:5e3,hideProgressBar:!0,closeButton:!0,progressClassName:"toast-progress-bar-success"})},D=async()=>{d("Approving ..."),c();try{if(!S&&_){_();return}await i.Am.promise(A(),{pending:"Purchasing product...",success:"Product purchased successfully",error:"Failed to purchase product"})}catch(e){console.log({e}),o((null==e?void 0:e.reason)||(null==e?void 0:e.message)||"Something went wrong. Try again.")}finally{d(null)}};if(!C)return null;let O=r.formatEther(C.price.toString());return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"shadow-lg relative rounded-b-lg",children:(0,n.jsxs)("p",{className:"group",children:[(0,n.jsxs)("div",{className:"aspect-w-1 aspect-h-1 w-full overflow-hidden bg-white xl:aspect-w-7 xl:aspect-h-8 ",children:[(0,n.jsxs)("span",{className:"absolute z-10 right-0 mt-4 bg-amber-400 text-black p-1 rounded-l-lg px-4",children:[C.sold," sold"]}),(0,n.jsx)("img",{src:C.image,alt:"image",className:"w-full h-80 rounded-t-md  object-cover object-center group-hover:opacity-75"}),(0,n.jsx)(h(),{href:"https://explorer.celo.org/alfajores/address/".concat(C.owner),className:"absolute -mt-7 ml-6 h-16 w-16 rounded-full",children:f(C.owner)})]}),(0,n.jsx)("div",{className:"m-5",children:(0,n.jsxs)("div",{className:"pt-1",children:[(0,n.jsx)("p",{className:"mt-4 text-2xl font-bold",children:C.name}),(0,n.jsxs)("button",{onClick:D,className:"mt-4 h-14 w-full border-[1px] border-gray-500 text-black p-2 rounded-lg hover:bg-black hover:text-white",children:["Buy for ",O," cUSD"]}),(0,n.jsx)("button",{onClick:()=>T(!0),className:"mt-4 mb-4 h-14 w-full border-[1px] border-gray-500 text-black p-2 rounded-lg hover:bg-black hover:text-white",children:"View Details"})]})})]})}),(0,n.jsx)("div",{children:N&&(0,n.jsx)(j,{product:C,onClose:()=>T(!1),handlePurchase:A})})]})},T=e=>{let{message:t,clear:a}=e;return(0,n.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[(0,n.jsx)("span",{className:"block sm:inline",children:t}),(0,n.jsx)("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:(0,n.jsxs)("svg",{className:"fill-current h-6 w-6 text-red-500",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",onClick:a,children:[(0,n.jsx)("title",{children:"Close"}),(0,n.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]})},S=e=>{let{message:t}=e;return(0,n.jsxs)("div",{className:"bg-blue-100 border-t border-b border-blue-500 text-blue-700 px-4 py-3",role:"alert",children:[(0,n.jsx)("p",{className:"font-bold",children:t||"Loading..."}),(0,n.jsx)("p",{className:"text-sm",children:"Interacting with smart contract."})]})},k=e=>{let{message:t}=e;return(0,n.jsx)("div",{className:"bg-teal-100 border-t-4 border-teal-500 rounded-b text-teal-900 px-4 py-3 shadow-md",role:"alert",children:(0,n.jsx)("div",{className:"flex",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-bold",children:"Success"}),(0,n.jsx)("p",{className:"text-sm",children:t})]})})})};let P=()=>{let{data:e,isLoading:t}=(0,l.do)({address:d.Lk,abi:d.Mt,functionName:"getProductsLength",args:[],onError:e=>{console.log({err:e})}});return{productsLength:null==e?void 0:e.toString(),isLoading:t}};var C=()=>{let{data:e}=x("getProductsLength",[],!0),t=e?Number(e.toString()):0,[a,r]=(0,s.useState)(""),[l,i]=(0,s.useState)(""),[o,d]=(0,s.useState)(""),{productsLength:c,isLoading:u}=P(),p=()=>{r(""),i(""),d("")};return(0,n.jsxs)("div",{children:[a&&(0,n.jsx)(T,{message:a,clear:p}),l&&(0,n.jsx)(k,{message:l}),o&&(0,n.jsx)(S,{message:o}),(0,n.jsxs)("div",{className:"mx-auto max-w-2xl py-16 px-4 sm:py-24 sm:px-6 lg:max-w-7xl lg:px-8",children:[(0,n.jsx)("h2",{className:"sr-only",children:"Products"}),(0,n.jsx)("div",{className:"mb-4 text-center border border-gray-400 rounded p-4",children:(0,n.jsx)("p",{className:"text-lg text-gray-600",children:u?(0,n.jsx)("span",{children:"Loading products..."}):(0,n.jsxs)("span",{children:["Total products: ",c," "]})})}),(0,n.jsx)("div",{className:"grid grid-cols-1 gap-y-10 gap-x-6 sm:grid-cols-2 lg:grid-cols-3 xl:gap-x-8",children:(()=>{if(!t)return null;let e=[];for(let a=0;a<t;a++)e.push((0,n.jsx)(N,{product:e,id:a,setSuccess:i,setError:r,setLoading:d,loading:o,clear:p},a));return e})()})]})]})};function E(){return(0,n.jsxs)("div",{children:[(0,n.jsx)(m,{}),(0,n.jsx)(C,{})]})}}},function(e){e.O(0,[373,774,888,179],function(){return e(e.s=7314)}),_N_E=e.O()}]);